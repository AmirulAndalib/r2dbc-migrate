language: java
dist: bionic
jdk:
  - "openjdk11"
cache:
  directories:
    - "/home/travis/.m2"
    - "/home/travis/docker-images"
install: "/bin/true"
script:
  - mkdir /home/travis/docker-images || true
  - docker load < /home/travis/docker-images/mssql.tar || true
  - docker load < /home/travis/docker-images/postgres.tar || true
  - docker load < /home/travis/docker-images/mysql.tar || true
  - (cd ./docker; docker-compose down -v; docker-compose up -d)
  - ./mvnw clean package -DenableStandaloneTests=true
  - rm -rf ~/.m2/repository/name/nkonev/r2dbc-migrate
  - docker save mcr.microsoft.com/mssql/server:2017-CU19-ubuntu-16.04 > /home/travis/docker-images/mssql.tar
  - docker save postgres:12.2 > /home/travis/docker-images/postgres.tar
  - docker save mysql:5.7 > /home/travis/docker-images/mysql.tar
